

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The indiredis package &#8212; indiredis 0.2.0 documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="References" href="references.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="references.html" title="References"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">indiredis 0.2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The indiredis package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-indiredis">
<span id="the-indiredis-package"></span><h1>The indiredis package<a class="headerlink" href="#module-indiredis" title="Permalink to this headline">¶</a></h1>
<p>This package provides a WSGI web application. This can be run by a wsgi complient web server.</p>
<p>The package is highly dependent on the indi-mr package, which includes functions to
convert XML data received from indiserver to values stored in redis.</p>
<p>Running indiredis with the python3 -m option, imports and runs the indi-mr function
inditoredis, and creates a wsgi web application with the function make_wsgi_app().</p>
<p>Finally it serves the web application with the Python waitress web server.</p>
<p>Instead of running this indiredis package, you could import it, and then run
make_wsgi_app() in your own script with your preferred web server.</p>
<div class="section" id="make-wsgi-app">
<h2>make_wsgi_app<a class="headerlink" href="#make-wsgi-app" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="indiredis.make_wsgi_app">
<code class="sig-prename descclassname">indiredis.</code><code class="sig-name descname">make_wsgi_app</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">redisserver</span></em>, <em class="sig-param"><span class="n">blob_folder</span><span class="o">=</span><span class="default_value">''</span></em>, <em class="sig-param"><span class="n">url</span><span class="o">=</span><span class="default_value">'/'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#indiredis.make_wsgi_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a wsgi application which can be served by a WSGI compatable web server.
Reads and writes to redis stores created by indi-mr</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>redisserver</strong> (<em>namedtuple</em>) – Named Tuple providing the redis server parameters</p></li>
<li><p><strong>blob_folder</strong> (<em>String</em>) – Folder where Blobs will be stored</p></li>
<li><p><strong>url</strong> (<em>String</em>) – URL at which the web service is served</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A WSGI callable application</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>skipole.WSGIApplication</p>
</dd>
</dl>
</dd></dl>

<p>This particular client application is general purpose, learning all instrument properties from the
redis store.</p>
<p>Assuming you have all the dependencies loaded, including a redis server and indiserver operating on
your localhost, you can use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">indiredis</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">blobfolder</span>
</pre></div>
</div>
<p>This runs the script __main__.py within indiredis, and serves the client at localhost:8000</p>
<p>You can also try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">indiredis</span> <span class="o">--</span><span class="n">help</span>
</pre></div>
</div>
<p>which displays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">indiredis</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="n">blobdirectorypath</span>

<span class="n">INDI</span> <span class="n">web</span> <span class="n">client</span> <span class="n">communicating</span> <span class="n">to</span> <span class="n">indiserver</span> <span class="ow">and</span> <span class="n">saving</span> <span class="n">data</span> <span class="n">to</span> <span class="n">redis</span> <span class="ow">and</span> <span class="n">to</span> <span class="n">a</span>
<span class="n">BLOB</span> <span class="n">directory</span><span class="o">.</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">blobdirectorypath</span>     <span class="n">Path</span> <span class="n">of</span> <span class="n">the</span> <span class="n">directory</span> <span class="n">where</span> <span class="n">BLOB</span><span class="s1">&#39;s will be set</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">-</span><span class="n">p</span> <span class="n">PORT</span><span class="p">,</span> <span class="o">--</span><span class="n">port</span> <span class="n">PORT</span>  <span class="n">Port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">web</span> <span class="n">service</span> <span class="p">(</span><span class="n">default</span> <span class="mi">8000</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">iport</span> <span class="n">IPORT</span>         <span class="n">Port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">indiserver</span> <span class="p">(</span><span class="n">default</span> <span class="mi">7624</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">ihost</span> <span class="n">IHOST</span>         <span class="n">Hostname</span> <span class="n">of</span> <span class="n">the</span> <span class="n">indiserver</span> <span class="p">(</span><span class="n">default</span> <span class="n">localhost</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">rport</span> <span class="n">RPORT</span>         <span class="n">Port</span> <span class="n">of</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">server</span> <span class="p">(</span><span class="n">default</span> <span class="mi">6379</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">rhost</span> <span class="n">RHOST</span>         <span class="n">Hostname</span> <span class="n">of</span> <span class="n">the</span> <span class="n">redis</span> <span class="n">server</span> <span class="p">(</span><span class="n">default</span> <span class="n">localhost</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">prefix</span> <span class="n">PREFIX</span>       <span class="n">Prefix</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">redis</span> <span class="n">keys</span> <span class="p">(</span><span class="n">default</span> <span class="n">indi_</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">toindipub</span> <span class="n">TOINDIPUB</span>
                        <span class="n">Redis</span> <span class="n">channel</span> <span class="n">used</span> <span class="n">to</span> <span class="n">publish</span> <span class="n">data</span> <span class="n">to</span> <span class="n">indiserver</span>
                        <span class="p">(</span><span class="n">default</span> <span class="n">to_indi</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">fromindipub</span> <span class="n">FROMINDIPUB</span>
                        <span class="n">Redis</span> <span class="n">channel</span> <span class="n">on</span> <span class="n">which</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">published</span> <span class="kn">from</span>
                        <span class="nn">indiserver</span> <span class="p">(</span><span class="n">default</span> <span class="n">from_indi</span><span class="p">)</span><span class="o">.</span>
  <span class="o">--</span><span class="n">version</span>             <span class="n">show</span> <span class="n">program</span><span class="s1">&#39;s version number and exit</span>
</pre></div>
</div>
<p>If you want to import indiredis and run your own web server in your own script, further examples are
given below which can be adapted to your own system.</p>
<p>Open three terminals.</p>
<p>In terminal one, run indiserver with the simulated instruments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">indiserver</span> <span class="o">-</span><span class="n">v</span> <span class="n">indi_simulator_telescope</span> <span class="n">indi_simulator_ccd</span>
</pre></div>
</div>
<p>In terminal two, run inditoredis with the following script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">inditoredis</span><span class="p">,</span> <span class="n">indi_server</span><span class="p">,</span> <span class="n">redis_server</span>

<span class="n">indi_host</span> <span class="o">=</span> <span class="n">indi_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7624</span><span class="p">)</span>
<span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="n">inditoredis</span><span class="p">(</span><span class="n">indi_host</span><span class="p">,</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="s1">&#39;/path/to/blob_folder&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In terminal three, run the following web service:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">redis_server</span>
<span class="kn">from</span> <span class="nn">indiredis</span> <span class="k">import</span> <span class="n">make_wsgi_app</span>

<span class="c1"># any wsgi web server can serve the wsgi application produced by</span>
<span class="c1"># make_wsgi_app, in this example the web server &#39;waitress&#39; is used</span>

<span class="kn">from</span> <span class="nn">waitress</span> <span class="k">import</span> <span class="n">serve</span>

<span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="c1"># create a wsgi application, which requires the redis_host tuple and</span>
<span class="c1"># set the blob_folder to a directory of your choice</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">make_wsgi_app</span><span class="p">(</span><span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="s1">&#39;/path/to/blob_folder&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">application</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Are you sure the skipole framework is installed?&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># blocking call which serves the application with the python waitress web server</span>
<span class="n">serve</span><span class="p">(</span><span class="n">application</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, from your web browser connect to localhost:8000</p>
<p>Wait a few seconds, and the devices, with their properties, should be discovered and displayed.</p>
<p>To end the program, press Ctrl-c a few times in the terminal.</p>
<p>For further information on the functions provided by indi_mr, see the documentation at:</p>
<p><a class="reference external" href="https://indi-mr.readthedocs.io">https://indi-mr.readthedocs.io</a></p>
<p>A further example, still with indiserver running in another terminal, which shows how inditoredis
and the web service can be run by a single script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">inditoredis</span><span class="p">,</span> <span class="n">indi_server</span><span class="p">,</span> <span class="n">redis_server</span>

<span class="kn">from</span> <span class="nn">indiredis</span> <span class="k">import</span> <span class="n">make_wsgi_app</span>

<span class="c1"># any wsgi web server can serve the wsgi application produced by</span>
<span class="c1"># make_wsgi_app, in this example the web server &#39;waitress&#39; is used</span>

<span class="kn">from</span> <span class="nn">waitress</span> <span class="k">import</span> <span class="n">serve</span>

<span class="c1"># define the hosts/ports where servers are listenning, these functions return named tuples</span>
<span class="c1"># which are required as arguments to inditoredis() and to indiwsgi.make_wsgi_app()</span>

<span class="n">indi_host</span> <span class="o">=</span> <span class="n">indi_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">7624</span><span class="p">)</span>
<span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="c1"># Set a directory of your choice where blobs will be stored</span>
<span class="n">BLOBS</span> <span class="o">=</span> <span class="s1">&#39;/path/to/blob_folder&#39;</span>

<span class="c1"># create a wsgi application</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">make_wsgi_app</span><span class="p">(</span><span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
<span class="k">if</span> <span class="n">application</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR:Are you sure the skipole framework is installed?&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># serve the application with the python waitress web server in its own thread</span>
<span class="n">webapp</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">serve</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">application</span><span class="p">,),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;host&#39;</span><span class="p">:</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">:</span><span class="mi">8000</span><span class="p">})</span>
<span class="c1"># and start it</span>
<span class="n">webapp</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># and start inditoredis</span>
<span class="n">inditoredis</span><span class="p">(</span><span class="n">indi_host</span><span class="p">,</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
</pre></div>
</div>
<p>On running this script in a terminal, connect your browser to localhost:8000 to view the web pages.</p>
<p>The __main__.py script in the indiredis package is very similar to the above example with the addition of
accepting host, port, blob_folder, etc., as script arguments.</p>
<p>And a further example using the driverstoredis function, which does not need indiserver:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">driverstoredis</span><span class="p">,</span> <span class="n">redis_server</span>

<span class="kn">from</span> <span class="nn">indiredis</span> <span class="k">import</span> <span class="n">make_wsgi_app</span>

<span class="c1"># any wsgi web server can serve the wsgi application produced by</span>
<span class="c1"># make_wsgi_app, in this example the web server &#39;waitress&#39; is used</span>

<span class="kn">from</span> <span class="nn">waitress</span> <span class="k">import</span> <span class="n">serve</span>

<span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="c1"># Set a directory of your choice where blobs will be stored</span>
<span class="n">BLOBS</span> <span class="o">=</span> <span class="s1">&#39;/path/to/blob_folder&#39;</span>

<span class="c1"># create a wsgi application</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">make_wsgi_app</span><span class="p">(</span><span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
<span class="k">if</span> <span class="n">application</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR:Are you sure the skipole framework is installed?&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># serve the application with the python waitress web server in its own thread</span>
<span class="n">webapp</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">serve</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">application</span><span class="p">,),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;host&#39;</span><span class="p">:</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">:</span><span class="mi">8000</span><span class="p">})</span>
<span class="c1"># and start it</span>
<span class="n">webapp</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># and start driverstoredis</span>
<span class="n">driverstoredis</span><span class="p">([</span><span class="s2">&quot;indi_simulator_telescope&quot;</span><span class="p">,</span> <span class="s2">&quot;indi_simulator_ccd&quot;</span><span class="p">],</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="indi-over-mqtt">
<h2>INDI over MQTT<a class="headerlink" href="#indi-over-mqtt" title="Permalink to this headline">¶</a></h2>
<p>The project indi-mr includes functions for transmitting INDI data via an MQTT broker. For complete information
see the indi-mr documentation. The example below shows how it could be used with the indiredis client.</p>
<p>If these scripts are to be used, your machines need the Python MQTT client which is used by the indi-mr
functions. This requires:</p>
<p>python3 -m pip install paho-mqtt</p>
<p>At the remote sites where instruments and drivers are connected, the following script is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">driverstomqtt</span><span class="p">,</span> <span class="n">mqtt_server</span>

<span class="c1"># define the host/port where the MQTT server is listenning, this function returns a named tuple.</span>

<span class="n">mqtt_host</span> <span class="o">=</span> <span class="n">mqtt_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;10.34.167.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">1883</span><span class="p">)</span>

<span class="c1"># blocking call which runs the service, communicating between drivers and mqtt</span>

<span class="n">driverstomqtt</span><span class="p">([</span><span class="s2">&quot;indi_simulator_telescope&quot;</span><span class="p">,</span> <span class="s2">&quot;indi_simulator_ccd&quot;</span><span class="p">],</span> <span class="s1">&#39;indi_drivers01&#39;</span><span class="p">,</span> <span class="n">mqtt_host</span><span class="p">)</span>

<span class="c1"># The list of two simulated drivers shown above should be replaced by a list of your own drivers.</span>
</pre></div>
</div>
<p>Substitute your own MQTT server ip address for 10.34.167.1, and your own mqtt id for ‘indi_drivers01’.</p>
<p>The above script uses the blocking function driverstomqtt to run the drivers, and publishes/receives
INDI data via MQTT. At the central site where the redis and web servers are, the following is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span><span class="o">,</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">indi_mr</span> <span class="k">import</span> <span class="n">mqtttoredis</span><span class="p">,</span> <span class="n">mqtt_server</span><span class="p">,</span> <span class="n">redis_server</span>

<span class="kn">from</span> <span class="nn">indiredis</span> <span class="k">import</span> <span class="n">make_wsgi_app</span>

<span class="c1"># any wsgi web server can serve the wsgi application produced by</span>
<span class="c1"># make_wsgi_app, in this example the web server &#39;waitress&#39; is used</span>

<span class="kn">from</span> <span class="nn">waitress</span> <span class="k">import</span> <span class="n">serve</span>

<span class="n">mqtt_host</span> <span class="o">=</span> <span class="n">mqtt_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;10.34.167.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">1883</span><span class="p">)</span>
<span class="n">redis_host</span> <span class="o">=</span> <span class="n">redis_server</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>

<span class="c1"># Set a directory of your choice where blobs will be stored</span>
<span class="n">BLOBS</span> <span class="o">=</span> <span class="s1">&#39;/path/to/blob_folder&#39;</span>

<span class="c1"># create a wsgi application</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">make_wsgi_app</span><span class="p">(</span><span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
<span class="k">if</span> <span class="n">application</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR:Are you sure the skipole framework is installed?&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># serve the application with the python waitress web server in its own thread</span>
<span class="n">webapp</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">serve</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">application</span><span class="p">,),</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;host&#39;</span><span class="p">:</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">:</span><span class="mi">8000</span><span class="p">})</span>
<span class="c1"># and start it</span>
<span class="n">webapp</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># and start mqtttoredis</span>
<span class="n">mqtttoredis</span><span class="p">(</span><span class="s1">&#39;indi_client01&#39;</span><span class="p">,</span> <span class="n">mqtt_host</span><span class="p">,</span> <span class="n">redis_host</span><span class="p">,</span> <span class="n">blob_folder</span><span class="o">=</span><span class="n">BLOBS</span><span class="p">)</span>
</pre></div>
</div>
<p>The blocking function mqtttoredis converts the INDI data received via MQTT to redis stored data, which again
is served by the indiredis client running in its own thread.</p>
</div>
<div class="section" id="web-client-limitation">
<h2>Web client limitation<a class="headerlink" href="#web-client-limitation" title="Permalink to this headline">¶</a></h2>
<p>The web client employs a browser refresh every ten seconds, so data changes which update at a faster rate
will jump rather than change smoothly.</p>
<p>Sending BLOB’s from client to device is achieved on the browser by giving the user the option of uploading
a file. This may be required for certain instruments, which may, for example, need a configuration uploaded,
or a script of instructions.</p>
<p>The indi protocol requires the file format and the size before compression to be set in the XML data. This
wsgi application uses the uploaded filename extension as the format, and the uploaded file size as the ‘size’
parameter. To comply with the specification therefore you should only upload uncompressed files.</p>
<p>The web client gives you the option to request file compression. If this is chosen, the wsgi application will
take your uploaded uncompressed file (from which it derives the size) and will then compress it using gzip,
and add .gz to the extension format, and will then send the data on to the remote INDI drivers.</p>
<p>Note: this is done by holding the file in variables (in memory) rather than reading/writing to disc, which
may not work with very large files.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">The indiredis package</a><ul>
<li><a class="reference internal" href="#make-wsgi-app">make_wsgi_app</a></li>
<li><a class="reference internal" href="#indi-over-mqtt">INDI over MQTT</a></li>
<li><a class="reference internal" href="#web-client-limitation">Web client limitation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="references.html"
                        title="next chapter">References</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/usage/functions.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="references.html" title="References"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">indiredis 0.2.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">The indiredis package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Bernard Czenkusz.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>